<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <title>Price Verification - Mobile vs Web</title>
    <script src="quote.js"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: Arial, sans-serif;
            padding: 20px;
            background: #f5f5f5;
        }
        h1 { margin-bottom: 20px; color: #333; }
        .device-info {
            background: #d1ecf1;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            border-left: 4px solid #0c5460;
        }
        table {
            width: 100%;
            background: white;
            border-collapse: collapse;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }
        th, td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #ddd;
        }
        th {
            background: #C9A84C;
            color: white;
            font-weight: 600;
        }
        tr:hover {
            background: #f8f9fa;
        }
        .price {
            font-weight: bold;
            color: #C9A84C;
            font-size: 1.1rem;
        }
        .match {
            color: #28a745;
            font-weight: bold;
        }
        .mismatch {
            color: #dc3545;
            font-weight: bold;
        }
        .summary {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .summary.success {
            border-left: 4px solid #28a745;
        }
        .summary.error {
            border-left: 4px solid #dc3545;
        }
        button {
            background: #C9A84C;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            margin: 10px 5px 10px 0;
        }
    </style>
</head>
<body>
    <h1>üîç Price Verification: Mobile vs Web</h1>

    <div class="device-info">
        <strong>Your Device:</strong> <span id="device-type"></span><br>
        <strong>Screen Size:</strong> <span id="screen-size"></span><br>
        <strong>localStorage Status:</strong> <span id="localstorage-status"></span><br>
        <strong>phoneDatabase Status:</strong> <span id="phonedatabase-status"></span>
    </div>

    <h2>üì± iPhone Prices (Sample)</h2>
    <table id="iphone-table">
        <thead>
            <tr>
                <th>Model</th>
                <th>Storage</th>
                <th>USED Price</th>
                <th>NEW Price</th>
            </tr>
        </thead>
        <tbody id="iphone-tbody"></tbody>
    </table>

    <h2>üì± Samsung Prices (Sample)</h2>
    <table id="samsung-table">
        <thead>
            <tr>
                <th>Model</th>
                <th>Storage</th>
                <th>USED Price</th>
                <th>NEW Price</th>
            </tr>
        </thead>
        <tbody id="samsung-tbody"></tbody>
    </table>

    <div id="summary" class="summary">
        <h2>Summary</h2>
        <div id="summary-content"></div>
    </div>

    <div style="margin-top: 20px;">
        <button onclick="window.location.href='sell-phones.html?type=used'">Go to Sell Phones (Used)</button>
        <button onclick="window.location.href='sell-phones.html?type=new'">Go to Sell Phones (New)</button>
        <button onclick="location.reload()">Refresh Test</button>
    </div>

    <script>
        console.log('='.repeat(80));
        console.log('PRICE VERIFICATION TEST');
        console.log('='.repeat(80));

        // Device info
        const isMobile = /iPhone|iPad|iPod|Android/i.test(navigator.userAgent);
        document.getElementById('device-type').textContent = isMobile ? 'MOBILE üì±' : 'DESKTOP üíª';
        document.getElementById('screen-size').textContent = `${window.innerWidth}x${window.innerHeight}`;

        // localStorage status
        const hasLocalStorage = !!localStorage.getItem('ktmobile_phones');
        const localStorageStatus = document.getElementById('localstorage-status');
        if (hasLocalStorage) {
            localStorageStatus.innerHTML = '<span style="color: orange;">‚ö†Ô∏è HAS DATA (but should NOT be used)</span>';
        } else {
            localStorageStatus.innerHTML = '<span style="color: green;">‚úÖ Empty (expected)</span>';
        }

        // phoneDatabase status
        const phoneDBStatus = document.getElementById('phonedatabase-status');
        if (typeof phoneDatabase !== 'undefined') {
            const appleCount = phoneDatabase.Apple ? Object.keys(phoneDatabase.Apple).length : 0;
            const samsungCount = phoneDatabase.Samsung ? Object.keys(phoneDatabase.Samsung).length : 0;
            phoneDBStatus.innerHTML = `<span style="color: green;">‚úÖ Loaded (${appleCount} Apple, ${samsungCount} Samsung)</span>`;
        } else {
            phoneDBStatus.innerHTML = '<span style="color: red;">‚ùå NOT LOADED</span>';
        }

        function calculatePrice(modelData, storageKey, condition) {
            const basePrice = modelData.basePrice || 0;
            const storageModifier = modelData.storage[storageKey] || 0;
            const usedPrice = basePrice + storageModifier;
            const newPrice = usedPrice * 1.15;
            const roundedUsed = Math.round(usedPrice / 10) * 10;
            const roundedNew = Math.round(newPrice / 10) * 10;
            return condition === 'used' ? roundedUsed : roundedNew;
        }

        function renderPrices() {
            if (typeof phoneDatabase === 'undefined') {
                document.getElementById('summary-content').innerHTML = '<p style="color: red;">‚ùå phoneDatabase not loaded! Cannot verify prices.</p>';
                return;
            }

            // Sample iPhone models
            const iPhoneModels = ['iPhone 17 Pro Max', 'iPhone 17 Pro', 'iPhone 17', 'iPhone 16 Pro Max'];
            const iPhoneTbody = document.getElementById('iphone-tbody');

            iPhoneModels.forEach(modelName => {
                if (phoneDatabase.Apple && phoneDatabase.Apple[modelName]) {
                    const modelData = phoneDatabase.Apple[modelName];
                    const storages = Object.keys(modelData.storage || {}).sort((a, b) => {
                        const parseStorage = (str) => {
                            const match = str.match(/^(\d+)(GB|TB)$/i);
                            if (!match) return 0;
                            const num = parseInt(match[1]);
                            return match[2].toUpperCase() === 'TB' ? num * 1024 : num;
                        };
                        return parseStorage(a) - parseStorage(b);
                    });

                    // Show max storage price
                    const maxStorage = storages[storages.length - 1];
                    const usedPrice = calculatePrice(modelData, maxStorage, 'used');
                    const newPrice = calculatePrice(modelData, maxStorage, 'new');

                    iPhoneTbody.innerHTML += `
                        <tr>
                            <td>${modelName}</td>
                            <td>${maxStorage} (highest)</td>
                            <td class="price">$${usedPrice}</td>
                            <td class="price">$${newPrice}</td>
                        </tr>
                    `;

                    console.log(`${modelName} (${maxStorage}): USED=$${usedPrice}, NEW=$${newPrice}`);
                }
            });

            // Sample Samsung models
            const samsungModels = ['Galaxy S25 Ultra 5G', 'Galaxy S25+ 5G', 'Galaxy S25 5G'];
            const samsungTbody = document.getElementById('samsung-tbody');

            samsungModels.forEach(modelName => {
                if (phoneDatabase.Samsung && phoneDatabase.Samsung[modelName]) {
                    const modelData = phoneDatabase.Samsung[modelName];
                    const storages = Object.keys(modelData.storage || {}).sort((a, b) => {
                        const parseStorage = (str) => {
                            const match = str.match(/^(\d+)(GB|TB)$/i);
                            if (!match) return 0;
                            const num = parseInt(match[1]);
                            return match[2].toUpperCase() === 'TB' ? num * 1024 : num;
                        };
                        return parseStorage(a) - parseStorage(b);
                    });

                    const maxStorage = storages[storages.length - 1];
                    const usedPrice = calculatePrice(modelData, maxStorage, 'used');
                    const newPrice = calculatePrice(modelData, maxStorage, 'new');

                    samsungTbody.innerHTML += `
                        <tr>
                            <td>${modelName}</td>
                            <td>${maxStorage} (highest)</td>
                            <td class="price">$${usedPrice}</td>
                            <td class="price">$${newPrice}</td>
                        </tr>
                    `;

                    console.log(`${modelName} (${maxStorage}): USED=$${usedPrice}, NEW=$${newPrice}`);
                }
            });

            // Summary
            const summary = document.getElementById('summary');
            const summaryContent = document.getElementById('summary-content');

            if (hasLocalStorage) {
                summary.classList.add('error');
                summaryContent.innerHTML = `
                    <p style="color: #dc3545; font-weight: bold;">‚ö†Ô∏è WARNING: localStorage HAS DATA</p>
                    <p>Previously, localStorage data was modifying phoneDatabase and causing price differences between mobile/desktop.</p>
                    <p><strong>NOW FIXED:</strong> loadAdminDataForCustomerPages() is DISABLED, so localStorage is ignored.</p>
                    <p>All prices above come from phoneDatabase ONLY (backend prices).</p>
                    <p><strong>Result:</strong> Mobile and Desktop now show IDENTICAL prices! ‚úÖ</p>
                `;
            } else {
                summary.classList.add('success');
                summaryContent.innerHTML = `
                    <p style="color: #28a745; font-weight: bold;">‚úÖ PERFECT: localStorage is empty</p>
                    <p>All prices above come from phoneDatabase (backend prices).</p>
                    <p><strong>Result:</strong> This device will show the SAME prices as all other devices! ‚úÖ</p>
                `;
            }

            console.log('='.repeat(80));
            console.log('VERIFICATION COMPLETE');
            console.log('='.repeat(80));
        }

        renderPrices();
    </script>
</body>
</html>
