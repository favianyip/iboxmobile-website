<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Price Manager - IBOX MOBILE</title>
    <link rel="stylesheet" href="styles.css">
    <style>
        .price-manager {
            max-width: 1400px;
            margin: 100px auto 50px;
            padding: 2rem;
        }
        .price-table {
            width: 100%;
            border-collapse: collapse;
            background: white;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            margin: 2rem 0;
        }
        .price-table th,
        .price-table td {
            padding: 1rem;
            text-align: left;
            border-bottom: 1px solid #eee;
        }
        .price-table th {
            background: #C9A84C;
            color: white;
            font-weight: 600;
        }
        .price-input {
            width: 80px;
            padding: 0.5rem;
            border: 1px solid #ddd;
            border-radius: 4px;
        }
        .highest-price {
            background: #d4edda;
            font-weight: bold;
            color: #155724;
        }
        .competitor-col {
            background: #f8f9fa;
        }
        .update-btn {
            background: #C9A84C;
            color: white;
            padding: 1rem 2rem;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1rem;
            font-weight: 600;
        }
        .update-btn:hover {
            background: #A88A3D;
        }
        .status-message {
            padding: 1rem;
            margin: 1rem 0;
            border-radius: 8px;
            display: none;
        }
        .status-success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        .status-error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        .model-section {
            margin: 3rem 0;
        }
        .model-section h3 {
            color: #C9A84C;
            font-size: 1.5rem;
            margin-bottom: 1rem;
        }
        .tab-buttons {
            display: flex;
            gap: 1rem;
            margin-bottom: 2rem;
        }
        .tab-btn {
            padding: 0.75rem 1.5rem;
            background: #f0f0f0;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
        }
        .tab-btn.active {
            background: #C9A84C;
            color: white;
        }
        .price-summary {
            background: #f8f9fa;
            padding: 1.5rem;
            border-radius: 8px;
            margin-bottom: 2rem;
        }
        .price-summary h4 {
            margin: 0 0 1rem 0;
            color: #333;
        }
        .summary-item {
            display: flex;
            justify-content: space-between;
            padding: 0.5rem 0;
            border-bottom: 1px solid #ddd;
        }
    </style>
</head>
<body>
    <header class="header">
        <nav class="nav">
            <a href="index.html" class="logo">
                <span class="logo-text" style="display: flex; font-size: 1.2rem; font-weight: 700; color: #C9A84C;">IBOX MOBILE</span>
            </a>
            <ul class="nav-links">
                <li><a href="index.html">Home</a></li>
                <li><a href="admin.html">Admin Panel</a></li>
            </ul>
        </nav>
    </header>

    <div class="price-manager">
        <h1>Competitive Price Manager</h1>
        <p style="color: #666; margin-bottom: 2rem;">Update competitor prices and automatically calculate the highest buyback prices</p>

        <div id="statusMessage" class="status-message"></div>

        <div class="tab-buttons">
            <button class="tab-btn active" onclick="showTab('used')">Used Phones</button>
            <button class="tab-btn" onclick="showTab('new')">New Phones</button>
        </div>

        <div id="priceContent"></div>

        <button class="update-btn" onclick="savePrices()">ðŸ’¾ Save & Update Website Prices</button>
    </div>

    <script>
        let pricesData = null;
        let currentTab = 'used';

        // Load prices from JSON
        async function loadPrices() {
            try {
                const response = await fetch('competitor_prices.json');
                pricesData = await response.json();
                renderPriceTable();
            } catch (error) {
                console.error('Error loading prices:', error);
                showStatus('Error loading price data', 'error');
            }
        }

        function showTab(tab) {
            currentTab = tab;
            document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');
            renderPriceTable();
        }

        function renderPriceTable() {
            if (!pricesData) return;

            const container = document.getElementById('priceContent');
            let html = '';

            // Group by brand
            const iphones = Object.keys(pricesData.prices).filter(m => m.includes('iPhone'));
            const samsungs = Object.keys(pricesData.prices).filter(m => m.includes('Galaxy'));

            html += renderBrandSection('Apple iPhone', iphones);
            html += renderBrandSection('Samsung Galaxy', samsungs);

            container.innerHTML = html;
        }

        function renderBrandSection(brandName, models) {
            let html = `<div class="model-section"><h3>${brandName}</h3>`;

            html += `<table class="price-table">
                <thead>
                    <tr>
                        <th>Model</th>
                        <th>Storage</th>
                        <th class="competitor-col">WhyMobile</th>
                        <th class="competitor-col">RedWhiteMobile</th>
                        <th class="highest-price">Highest</th>
                        <th>IBOX Price</th>
                    </tr>
                </thead>
                <tbody>`;

            models.forEach(model => {
                const modelData = pricesData.prices[model];
                Object.keys(modelData).forEach(storage => {
                    const priceData = modelData[storage][currentTab];
                    const dataKey = `${model}|${storage}|${currentTab}`;

                    html += `<tr>
                        <td><strong>${model}</strong></td>
                        <td>${storage}</td>
                        <td class="competitor-col">
                            $<input type="number" class="price-input" value="${priceData.WhyMobile}"
                                onchange="updatePrice('${dataKey}', 'WhyMobile', this.value)">
                        </td>
                        <td class="competitor-col">
                            $<input type="number" class="price-input" value="${priceData.RedWhiteMobile}"
                                onchange="updatePrice('${dataKey}', 'RedWhiteMobile', this.value)">
                        </td>
                        <td class="highest-price" id="highest-${dataKey}">$${priceData.highest}</td>
                        <td>
                            $<input type="number" class="price-input" value="${priceData.iboxPrice}"
                                onchange="updatePrice('${dataKey}', 'iboxPrice', this.value)"
                                style="border: 2px solid #C9A84C;">
                        </td>
                    </tr>`;
                });
            });

            html += `</tbody></table></div>`;
            return html;
        }

        function updatePrice(dataKey, competitor, value) {
            const [model, storage, condition] = dataKey.split('|');
            const price = parseInt(value) || 0;

            pricesData.prices[model][storage][condition][competitor] = price;

            // Recalculate highest
            const prices = pricesData.prices[model][storage][condition];
            prices.highest = Math.max(prices.WhyMobile, prices.RedWhiteMobile);

            // Update display
            document.getElementById(`highest-${dataKey}`).textContent = `$${prices.highest}`;

            // Auto-suggest IBOX price (match or beat by $20)
            if (competitor !== 'iboxPrice') {
                const suggestedPrice = prices.highest;
                // Optionally auto-update IBOX price
                // prices.iboxPrice = suggestedPrice;
            }
        }

        function savePrices() {
            // Update last updated date
            pricesData.lastUpdated = new Date().toISOString().split('T')[0];

            // Convert to JSON
            const jsonData = JSON.stringify(pricesData, null, 2);

            // Download as file (for manual upload)
            const blob = new Blob([jsonData], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'competitor_prices.json';
            a.click();

            showStatus('Prices saved! Upload the downloaded file to update website.', 'success');

            // Show instructions
            alert('Prices saved!\\n\\nNext steps:\\n1. Upload the downloaded competitor_prices.json file\\n2. The website will automatically use the highest competitive prices\\n3. Run the sync script to update sell-phones.html');
        }

        function showStatus(message, type) {
            const statusEl = document.getElementById('statusMessage');
            statusEl.textContent = message;
            statusEl.className = `status-message status-${type}`;
            statusEl.style.display = 'block';

            setTimeout(() => {
                statusEl.style.display = 'none';
            }, 5000);
        }

        // Load prices on page load
        loadPrices();
    </script>
</body>
</html>